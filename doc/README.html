<html><body style="margin: 2em; font-size: 15px"><pre><br/><u><b>FinalPM</b></u><br/><br/>  <i>Finally a good process manager.</i>                                               <br/>                                                                                <br/>  By default all actions are <b>graceful</b>. Old processes will always be cleanly     <br/>  stopped only once new processes have indicated they are <b>ready</b>.                <br/>                                                                                <br/>  <u>Examples</u>                                                                      <br/>                                                                                <br/>  # Start processes of all configured applications. This                        <br/>  # may cause existing processes to be gracefully stopped once                  <br/>  # they are ready, making this similar to 'restart'.                           <br/>  $ final-pm start all                                                          <br/>                                                                                <br/>  # For each running process, start a new one                                   <br/>  $ final-pm restart all                                                        <br/>                                                                                <br/>  # Stop all processes gracefully                                               <br/>  $ final-pm stop all                                                           <br/>                                                                                <br/>  # Stop processes by PID                                                       <br/>  $ final-pm stop pid=43342,pid=3452                                            <br/>                                                                                <br/>  # Stop processes by application name 'worker'                                 <br/>  $ final-pm stop worker                                                        <br/><br/><u><b>Arguments</b></u><br/><br/>  <b>-s</b>, <b>--select</b> <u>Selector</u>                  Select processes/applications.                                                <br/>  <b>-a</b>, <b>--action</b> start|stop|restart|kill   Start/Stop/Restart/Kill all selected.                                         <br/>  <b>-c</b>, <b>--config</b> <u>Config File</u>               Default: ./process-config.{js,json} and checks parent folders until a         <br/>                                         package.json is encountered. If you specified a config for an already running <br/>                                         application, it will be only be applied to new processes.                     <br/>  <b>--set</b> <u>app</u>-<u>key</u>=<u>value</u>                    Override a configuration key.                                                 <br/>  <b>-h</b>, <b>--help</b>                             Print this usage guide.                                                       <br/><br/><u><b>Selectors</b></u><br/><br/>  A Process/Application or comma-separated list of such.                        <br/>                                                                                <br/>  A selector can either be an <i>application name</i> or PID (pid=<i>id</i>). Using <b>all</b> as a  <br/>  selector will target all applications found in the configuration and/or are   <br/>  running, depending on the action. Prefix with <b>new:</b>, <b>running:</b>, <b>old:</b>, or        <br/>  <b>marked:</b> to only target processes in that <b>generation</b>.                          <br/><br/><u><b>Generations</b></u><br/><br/>  Processes are grouped in generations:                                         <br/>  The <b>new</b>, <b>running</b>, <b>old</b>, and <b>marked generation</b>.                                 <br/>                                                                                <br/>  <u>New Generation</u>                                                                <br/>  The <b>new generation</b> is where processes remain until they are considered <b>ready</b>. <br/>  A process is considered to be <b>ready</b> on the cluster <b>listen</b> event or when it    <br/>  sends the <b>ready</b> message, depending on the configuration (config: <b>ready-on</b>).   <br/>  Once a process is <b>ready</b> it is moved to the <b>running generation</b>. If a process   <br/>  is asked to be stopped while in the new generation, it is moved to the <b>marked <br/>  generation</b> instead. If a process exits abnormally while in the new            <br/>  generation, a new one is started (config: <b>restart-new-crashing</b>).              <br/>                                                                                <br/>  <u>Running Generation</u>                                                            <br/>  The <b>running generation</b> is where processes remain until they are <b>stopped</b>. At   <br/>  most the configured amount of processes for each application may reside here. <br/>  If the maximum was exceeded because new processes were started, the oldest    <br/>  processes will be moved to the <b>old generation</b>. If a process exits abnormally  <br/>  while in the running generation, a new one is started (config: <b>restart-       <br/>  crashing</b>).                                                                    <br/>                                                                                <br/>  <u>Old Generation</u>                                                                <br/>  The <b>old generation</b> is where processes remain when they should be <b>stopped</b>      <br/>  until they finally <b>exit</b>. A process moved to the <b>old generation</b> is sent the    <br/>  <b>SIGINT</b> signal. If the process does not exit within <b>stop-timeout</b> (default is   <br/>  no timeout), it is sent <b>SIGKILL</b> and removed from the old generation.          <br/>                                                                                <br/>  <u>Marked Generation</u>                                                             <br/>  New processes who were asked to stop are kept here, then are moved to the <b>old <br/>  generation</b> once they are <b>ready</b>. This means the programmer never has to worry  <br/>  about handling <b>SIGINT</b> signals during startup.                                 <br/><br/><u><b>Configuration</b></u><br/><br/>  Configuration may be done either JSON or JS, as well as environment variables <br/>  and command line arguments. Each configuration key can by overriden with an   <br/>  environment variable by replacing all dashes in the key  with underscores and <br/>  translating it to uppercase, finally prefixed with FINAL_PM_CONFIG_ i.e.      <br/>  restart-new-crashing=true becomes FINAL_PM_CONFIG_RESTART_NEW_CRASHING=true.  <br/>                                                                                <br/>  <u>Configuration Files</u>                                                           <br/>  JS files will be <b>require</b>d with the appropriate <i>NPM_PACKAGE_CONFIG_*</i>           <br/>  environment variables. JSON files on the other hand are parsed as-is.         <br/><br/>  <u>Example Config</u>                                                       <br/>  <i>final-pm start myApp</i>                                                 <br/>                                                                       <br/>  // sample-config.js                                                  <br/>  module.exports = {                                                   <br/>      'applications': [                                                <br/>          'name': 'myApp',                                             <br/>          'run': './sample-app.js',                                    <br/>          'args': ['arg1', 'arg2'],                                    <br/>          'node-args': ['--harmony'],                                  <br/>          'ready-on': 'message',                                       <br/>          'instances': process.env['NPM_PACKAGE_CONFIG_WORKERS'] || 4, <br/>      ]                                                                <br/>  };                                                                   <br/>                                                                       <br/><br/>  <u>Example App</u>                                                          <br/>                                                                       <br/>  // sample-app.js                                                     <br/>  const server = require('http').createServer((req, res) => {          <br/>      res.end(process.argv.join(' ')); // Reply with process arguments <br/>  }).listen(3333, (error) => {                                         <br/>      if (error) throw error;                                          <br/>                                                                       <br/>      console.log("Process started, telling master we are ready...");  <br/>      if (process.send)                                                <br/>          process.send('ready');                                       <br/>  });                                                                  <br/>                                                                       <br/>  process.on('SIGINT', () => {                                         <br/>      console.log("SIGINT received. Performing clean shutdown...");    <br/>      server.close();                                                  <br/>  });                                                                  <br/>                                                                       <br/></pre></body></html>