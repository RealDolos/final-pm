<html><body style="margin: 2em; font-size: 15px"><p></p>

<p>
<u><b>FinalPM</b></u><br>
</p>

<p>
&nbsp;&nbsp;<i>Finally&nbsp;a&nbsp;good&nbsp;process&nbsp;manager.</i><br>
</p>

<p>
&nbsp;&nbsp;By&nbsp;default&nbsp;all&nbsp;actions&nbsp;are&nbsp;<b>graceful</b>.&nbsp;Old&nbsp;processes&nbsp;will&nbsp;always&nbsp;be&nbsp;cleanly<br>
&nbsp;&nbsp;stopped&nbsp;only&nbsp;once&nbsp;new&nbsp;processes&nbsp;have&nbsp;indicated&nbsp;they&nbsp;are&nbsp;<b>ready</b>.<br>
</p>

<p>
&nbsp;&nbsp;<u>Examples</u><br>
</p>

<p>
&nbsp;&nbsp;&#35;&nbsp;Start&nbsp;processes&nbsp;of&nbsp;all&nbsp;configured&nbsp;applications.&nbsp;This<br>
&nbsp;&nbsp;&#35;&nbsp;may&nbsp;cause&nbsp;existing&nbsp;processes&nbsp;to&nbsp;be&nbsp;gracefully&nbsp;stopped&nbsp;once<br>
&nbsp;&nbsp;&#35;&nbsp;they&nbsp;are&nbsp;ready,&nbsp;making&nbsp;this&nbsp;similar&nbsp;to&nbsp;'restart'.<br>
&nbsp;&nbsp;$&nbsp;final-pm&nbsp;start&nbsp;all<br>
</p>

<p>
&nbsp;&nbsp;&#35;&nbsp;For&nbsp;each&nbsp;running&nbsp;process,&nbsp;start&nbsp;a&nbsp;new&nbsp;one<br>
&nbsp;&nbsp;$&nbsp;final-pm&nbsp;restart&nbsp;all<br>
</p>

<p>
&nbsp;&nbsp;&#35;&nbsp;Stop&nbsp;all&nbsp;processes&nbsp;gracefully<br>
&nbsp;&nbsp;$&nbsp;final-pm&nbsp;stop&nbsp;all<br>
</p>

<p>
&nbsp;&nbsp;&#35;&nbsp;Stop&nbsp;processes&nbsp;by&nbsp;PID<br>
&nbsp;&nbsp;$&nbsp;final-pm&nbsp;stop&nbsp;pid=43342,pid=3452<br>
</p>

<p>
&nbsp;&nbsp;&#35;&nbsp;Stop&nbsp;processes&nbsp;by&nbsp;application&nbsp;name&nbsp;'worker'<br>
&nbsp;&nbsp;$&nbsp;final-pm&nbsp;stop&nbsp;worker<br>
</p>

<p>
<u><b>Arguments</b></u><br>
</p>

<p>
<pre>  -s, --select Selector                  Select processes/applications.                                                
  -a, --action start|stop|restart|kill   Start/Stop/Restart/Kill all selected.                                         
  -c, --config Config File               Default: ./process-config.{js,json} and checks parent folders until a         
                                         package.json is encountered. If you specified a config for an already running 
                                         application, it will be only be applied to new processes.                     
  --set app-key=value                    Override a configuration key.                                                 
  -h, --help                             Print this usage guide.                                                       
</pre></p>

<p>
<u><b>Selectors</b></u><br>
</p>

<p>
&nbsp;&nbsp;A&nbsp;Process/Application&nbsp;or&nbsp;comma-separated&nbsp;list&nbsp;of&nbsp;such.<br>
</p>

<p>
&nbsp;&nbsp;A&nbsp;selector&nbsp;can&nbsp;either&nbsp;be&nbsp;an&nbsp;<i>application&nbsp;name</i>&nbsp;or&nbsp;PID&nbsp;(pid=<i>id</i>).&nbsp;Using&nbsp;<b>all</b>&nbsp;as&nbsp;a<br>
&nbsp;&nbsp;selector&nbsp;will&nbsp;target&nbsp;all&nbsp;applications&nbsp;found&nbsp;in&nbsp;the&nbsp;configuration&nbsp;and/or&nbsp;are<br>
&nbsp;&nbsp;running,&nbsp;depending&nbsp;on&nbsp;the&nbsp;action.&nbsp;Prefix&nbsp;with&nbsp;<b>new:</b>,&nbsp;<b>running:</b>,&nbsp;<b>old:</b>,&nbsp;or<br>
&nbsp;&nbsp;<b>marked:</b>&nbsp;to&nbsp;only&nbsp;target&nbsp;processes&nbsp;in&nbsp;that&nbsp;<b>generation</b>.<br>
</p>

<p>
<u><b>Generations</b></u><br>
</p>

<p>
&nbsp;&nbsp;Processes&nbsp;are&nbsp;grouped&nbsp;in&nbsp;generations:<br>
&nbsp;&nbsp;The&nbsp;<b>new</b>,&nbsp;<b>running</b>,&nbsp;<b>old</b>,&nbsp;and&nbsp;<b>marked&nbsp;generation</b>.<br>
</p>

<p>
&nbsp;&nbsp;<u>New&nbsp;Generation</u><br>
&nbsp;&nbsp;The&nbsp;<b>new&nbsp;generation</b>&nbsp;is&nbsp;where&nbsp;processes&nbsp;remain&nbsp;until&nbsp;they&nbsp;are&nbsp;considered&nbsp;<b>ready</b>.<br>
&nbsp;&nbsp;A&nbsp;process&nbsp;is&nbsp;considered&nbsp;to&nbsp;be&nbsp;<b>ready</b>&nbsp;on&nbsp;the&nbsp;cluster&nbsp;<b>listen</b>&nbsp;event&nbsp;or&nbsp;when&nbsp;it<br>
&nbsp;&nbsp;sends&nbsp;the&nbsp;<b>ready</b>&nbsp;message,&nbsp;depending&nbsp;on&nbsp;the&nbsp;configuration&nbsp;(config:&nbsp;<b>ready-on</b>).<br>
&nbsp;&nbsp;Once&nbsp;a&nbsp;process&nbsp;is&nbsp;<b>ready</b>&nbsp;it&nbsp;is&nbsp;moved&nbsp;to&nbsp;the&nbsp;<b>running&nbsp;generation</b>.&nbsp;If&nbsp;a&nbsp;process<br>
&nbsp;&nbsp;is&nbsp;asked&nbsp;to&nbsp;be&nbsp;stopped&nbsp;while&nbsp;in&nbsp;the&nbsp;new&nbsp;generation,&nbsp;it&nbsp;is&nbsp;moved&nbsp;to&nbsp;the&nbsp;<b>marked<br>
&nbsp;&nbsp;generation</b>&nbsp;instead.&nbsp;If&nbsp;a&nbsp;process&nbsp;exits&nbsp;abnormally&nbsp;while&nbsp;in&nbsp;the&nbsp;new<br>
&nbsp;&nbsp;generation,&nbsp;a&nbsp;new&nbsp;one&nbsp;is&nbsp;started&nbsp;(config:&nbsp;<b>restart-new-crashing</b>).<br>
</p>

<p>
&nbsp;&nbsp;<u>Running&nbsp;Generation</u><br>
&nbsp;&nbsp;The&nbsp;<b>running&nbsp;generation</b>&nbsp;is&nbsp;where&nbsp;processes&nbsp;remain&nbsp;until&nbsp;they&nbsp;are&nbsp;<b>stopped</b>.&nbsp;At<br>
&nbsp;&nbsp;most&nbsp;the&nbsp;configured&nbsp;amount&nbsp;of&nbsp;processes&nbsp;for&nbsp;each&nbsp;application&nbsp;may&nbsp;reside&nbsp;here.<br>
&nbsp;&nbsp;If&nbsp;the&nbsp;maximum&nbsp;was&nbsp;exceeded&nbsp;because&nbsp;new&nbsp;processes&nbsp;were&nbsp;started,&nbsp;the&nbsp;oldest<br>
&nbsp;&nbsp;processes&nbsp;will&nbsp;be&nbsp;moved&nbsp;to&nbsp;the&nbsp;<b>old&nbsp;generation</b>.&nbsp;If&nbsp;a&nbsp;process&nbsp;exits&nbsp;abnormally<br>
&nbsp;&nbsp;while&nbsp;in&nbsp;the&nbsp;running&nbsp;generation,&nbsp;a&nbsp;new&nbsp;one&nbsp;is&nbsp;started&nbsp;(config:&nbsp;<b>restart-<br>
&nbsp;&nbsp;crashing</b>).<br>
</p>

<p>
&nbsp;&nbsp;<u>Old&nbsp;Generation</u><br>
&nbsp;&nbsp;The&nbsp;<b>old&nbsp;generation</b>&nbsp;is&nbsp;where&nbsp;processes&nbsp;remain&nbsp;when&nbsp;they&nbsp;should&nbsp;be&nbsp;<b>stopped</b><br>
&nbsp;&nbsp;until&nbsp;they&nbsp;finally&nbsp;<b>exit</b>.&nbsp;A&nbsp;process&nbsp;moved&nbsp;to&nbsp;the&nbsp;<b>old&nbsp;generation</b>&nbsp;is&nbsp;sent&nbsp;the<br>
&nbsp;&nbsp;<b>SIGINT</b>&nbsp;signal.&nbsp;If&nbsp;the&nbsp;process&nbsp;does&nbsp;not&nbsp;exit&nbsp;within&nbsp;<b>stop-timeout</b>&nbsp;(default&nbsp;is<br>
&nbsp;&nbsp;no&nbsp;timeout),&nbsp;it&nbsp;is&nbsp;sent&nbsp;<b>SIGKILL</b>&nbsp;and&nbsp;removed&nbsp;from&nbsp;the&nbsp;old&nbsp;generation.<br>
</p>

<p>
&nbsp;&nbsp;<u>Marked&nbsp;Generation</u><br>
&nbsp;&nbsp;New&nbsp;processes&nbsp;who&nbsp;were&nbsp;asked&nbsp;to&nbsp;stop&nbsp;are&nbsp;kept&nbsp;here,&nbsp;then&nbsp;are&nbsp;moved&nbsp;to&nbsp;the&nbsp;<b>old<br>
&nbsp;&nbsp;generation</b>&nbsp;once&nbsp;they&nbsp;are&nbsp;<b>ready</b>.&nbsp;This&nbsp;means&nbsp;the&nbsp;programmer&nbsp;never&nbsp;has&nbsp;to&nbsp;worry<br>
&nbsp;&nbsp;about&nbsp;handling&nbsp;<b>SIGINT</b>&nbsp;signals&nbsp;during&nbsp;startup.<br>
</p>

<p>
<u><b>Configuration</b></u><br>
</p>

<p>
&nbsp;&nbsp;Configuration&nbsp;may&nbsp;be&nbsp;done&nbsp;in&nbsp;either&nbsp;JSON&nbsp;or&nbsp;JS,&nbsp;as&nbsp;well&nbsp;as&nbsp;environment<br>
&nbsp;&nbsp;variables&nbsp;and&nbsp;command&nbsp;line&nbsp;arguments.&nbsp;Each&nbsp;configuration&nbsp;key&nbsp;can&nbsp;by&nbsp;overriden<br>
&nbsp;&nbsp;with&nbsp;an&nbsp;environment&nbsp;variable&nbsp;by&nbsp;replacing&nbsp;all&nbsp;dashes&nbsp;in&nbsp;the&nbsp;key&nbsp;&nbsp;with<br>
&nbsp;&nbsp;underscores&nbsp;and&nbsp;translating&nbsp;it&nbsp;to&nbsp;uppercase,&nbsp;finally&nbsp;prefixed&nbsp;with<br>
&nbsp;&nbsp;FINAL_PM_CONFIG_&nbsp;i.e.&nbsp;&nbsp;restart-new-crashing=true&nbsp;becomes<br>
&nbsp;&nbsp;FINAL_PM_CONFIG_RESTART_NEW_CRASHING=true.<br>
</p>

<p>
&nbsp;&nbsp;<u>Configuration&nbsp;Files</u><br>
&nbsp;&nbsp;JS&nbsp;files&nbsp;will&nbsp;be&nbsp;<b>require</b>d&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;<i>NPM_PACKAGE_CONFIG_*</i><br>
&nbsp;&nbsp;environment&nbsp;variables.&nbsp;JSON&nbsp;files&nbsp;on&nbsp;the&nbsp;other&nbsp;hand&nbsp;are&nbsp;parsed&nbsp;as-is.<br>
</p>

<p>
&nbsp;&nbsp;<u>Example&nbsp;Config</u><br>
&nbsp;&nbsp;<i>final-pm&nbsp;start&nbsp;myApp</i><br>
</p>

<p>
&nbsp;&nbsp;//&nbsp;sample-config.js<br>
&nbsp;&nbsp;module.exports&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'applications':&nbsp;[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'name':&nbsp;'myApp',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'run':&nbsp;'./sample-app.js',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'args':&nbsp;['arg1',&nbsp;'arg2'],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'node-args':&nbsp;['--harmony'],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ready-on':&nbsp;'message',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'instances':&nbsp;process.env['NPM_PACKAGE_CONFIG_WORKERS']&nbsp;||&nbsp;4,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;};<br>
</p>

<p>
</p>

<p>
&nbsp;&nbsp;<u>Example&nbsp;App</u><br>
</p>

<p>
&nbsp;&nbsp;//&nbsp;sample-app.js<br>
&nbsp;&nbsp;const&nbsp;server&nbsp;=&nbsp;require('http').createServer((req,&nbsp;res)&nbsp;=>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.end(process.argv.join('&nbsp;'));&nbsp;//&nbsp;Reply&nbsp;with&nbsp;process&nbsp;arguments<br>
&nbsp;&nbsp;}).listen(3333,&nbsp;(error)&nbsp;=>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(error)&nbsp;throw&nbsp;error;<br>
</p>

<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log("Process&nbsp;started,&nbsp;telling&nbsp;master&nbsp;we&nbsp;are&nbsp;ready...");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(process.send)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process.send('ready');<br>
&nbsp;&nbsp;});<br>
</p>

<p>
&nbsp;&nbsp;process.on('SIGINT',&nbsp;()&nbsp;=>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log("SIGINT&nbsp;received.&nbsp;Performing&nbsp;clean&nbsp;shutdown...");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.close();<br>
&nbsp;&nbsp;});<br>
</p>

<p>
</p>

<p>
</p></body></html>