<html><body style="margin: 2em; font-size: 15px"><p></p><p>
<u><b>FinalPM</b></u><br>
</p><p>
<pre>  <i>Finally a good process manager.</i>                                               
</pre></p><p>
<pre>  By default all actions are <b>graceful</b>. Old processes will always be cleanly     
  stopped only once new processes have indicated they are <b>ready</b>.                
</pre></p><p>
<pre>  <u>Examples</u>                                                                      
</pre></p><p>
<pre>  &#35; Start processes of all configured applications. This                        
  &#35; may cause existing processes to be gracefully stopped once                  
  &#35; they are ready, making this similar to 'restart'.                           
  $ final-pm start all                                                          
</pre></p><p>
<pre>  &#35; For each running process, start a new one                                   
  $ final-pm restart all                                                        
</pre></p><p>
<pre>  &#35; Stop all processes gracefully                                               
  $ final-pm stop all                                                           
</pre></p><p>
<pre>  &#35; Stop processes by PID                                                       
  $ final-pm stop pid=43342,pid=3452                                            
</pre></p><p>
<pre>  &#35; Stop processes by application name 'worker'                                 
  $ final-pm stop worker                                                        
</pre></p><p>
<u><b>Arguments</b></u><br>
</p><p>
<pre>  <b>-s</b>, <b>--select</b> <u>Selector</u>                  Select processes/applications.                                                
  <b>-a</b>, <b>--action</b> start|stop|restart|kill   Start/Stop/Restart/Kill all selected.                                         
  <b>-c</b>, <b>--config</b> <u>Config File</u>               Default: ./process-config.{js,json} and checks parent folders until a         
                                         package.json is encountered. If you specified a config for an already running 
                                         application, it will be only be applied to new processes.                     
  <b>--set</b> <u>app</u>-<u>key</u>=<u>value</u>                    Override a configuration key.                                                 
  <b>-h</b>, <b>--help</b>                             Print this usage guide.                                                       
</pre></p><p>
<u><b>Selectors</b></u><br>
</p><p>
<pre>  A Process/Application or comma-separated list of such.                        
</pre></p><p>
<pre>  A selector can either be an <i>application name</i> or PID (pid=<i>id</i>). Using <b>all</b> as a  
  selector will target all applications found in the configuration and/or are   
  running, depending on the action. Prefix with <b>new:</b>, <b>running:</b>, <b>old:</b>, or        
  <b>marked:</b> to only target processes in that <b>generation</b>.                          
</pre></p><p>
<u><b>Generations</b></u><br>
</p><p>
<pre>  Processes are grouped in generations:                                         
  The <b>new</b>, <b>running</b>, <b>old</b>, and <b>marked generation</b>.                                 
</pre></p><p>
<pre>  <u>New Generation</u>                                                                
  The <b>new generation</b> is where processes remain until they are considered <b>ready</b>. 
  A process is considered to be <b>ready</b> on the cluster <b>listen</b> event or when it    
  sends the <b>ready</b> message, depending on the configuration (config: <b>ready-on</b>).   
  Once a process is <b>ready</b> it is moved to the <b>running generation</b>. If a process   
  is asked to be stopped while in the new generation, it is moved to the <b>marked 
  generation</b> instead. If a process exits abnormally while in the new            
  generation, a new one is started (config: <b>restart-new-crashing</b>).              
</pre></p><p>
<pre>  <u>Running Generation</u>                                                            
  The <b>running generation</b> is where processes remain until they are <b>stopped</b>. At   
  most the configured amount of processes for each application may reside here. 
  If the maximum was exceeded because new processes were started, the oldest    
  processes will be moved to the <b>old generation</b>. If a process exits abnormally  
  while in the running generation, a new one is started (config: <b>restart-       
  crashing</b>).                                                                    
</pre></p><p>
<pre>  <u>Old Generation</u>                                                                
  The <b>old generation</b> is where processes remain when they should be <b>stopped</b>      
  until they finally <b>exit</b>. A process moved to the <b>old generation</b> is sent the    
  <b>SIGINT</b> signal. If the process does not exit within <b>stop-timeout</b> (default is   
  no timeout), it is sent <b>SIGKILL</b> and removed from the old generation.          
</pre></p><p>
<pre>  <u>Marked Generation</u>                                                             
  New processes who were asked to stop are kept here, then are moved to the <b>old 
  generation</b> once they are <b>ready</b>. This means the programmer never has to worry  
  about handling <b>SIGINT</b> signals during startup.                                 
</pre></p><p>
<u><b>Configuration</b></u><br>
</p><p>
<pre>  Configuration may be done in either JSON or JS, as well as environment        
  variables and command line arguments. Each configuration key can by overriden 
  with an environment variable by replacing all dashes in the key  with         
  underscores and translating it to uppercase, finally prefixed with            
  FINAL_PM_CONFIG_ i.e.  restart-new-crashing=true becomes                      
  FINAL_PM_CONFIG_RESTART_NEW_CRASHING=true.                                    
</pre></p><p>
<pre>  <u>Configuration Files</u>                                                           
  JS files will be <b>require</b>d with the appropriate <i>NPM_PACKAGE_CONFIG_*</i>           
  environment variables. JSON files on the other hand are parsed as-is.         
</pre></p><p>
<pre>  <u>Example Config</u>                                                       
  <i>final-pm start myApp</i>                                                 
</pre></p><p>
<pre>  // sample-config.js                                                  
  module.exports = {                                                   
      'applications': [                                                
          'name': 'myApp',                                             
          'run': './sample-app.js',                                    
          'args': ['arg1', 'arg2'],                                    
          'node-args': ['--harmony'],                                  
          'ready-on': 'message',                                       
          'instances': process.env['NPM_PACKAGE_CONFIG_WORKERS'] || 4, 
      ]                                                                
  };                                                                   
</pre></p><p>
</p><p>
<pre>  <u>Example App</u>                                                          
</pre></p><p>
<pre>  // sample-app.js                                                     
  const server = require('http').createServer((req, res) => {          
      res.end(process.argv.join(' ')); // Reply with process arguments 
  }).listen(3333, (error) => {                                         
      if (error) throw error;                                          
</pre></p><p>
<pre>      console.log("Process started, telling master we are ready...");  
      if (process.send)                                                
          process.send('ready');                                       
  });                                                                  
</pre></p><p>
<pre>  process.on('SIGINT', () => {                                         
      console.log("SIGINT received. Performing clean shutdown...");    
      server.close();                                                  
  });                                                                  
</pre></p><p>
</p><p>
</p></body></html>